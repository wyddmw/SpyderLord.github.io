---
layout: post
category: blog
title: 刚体运动，视觉SLAM的观测方程
description: 特殊欧式群，旋转矩阵，平移向量，多个坐标系
---

## 三维空间的刚体运动
　　一个刚体在三维空间中的运动是如何描述的。[https://zhuanlan.zhihu.com/p/32937868](https://zhuanlan.zhihu.com/p/32937868)<br>

### 刚体运动
　　刚体运动在三维空间中，把一个几何物体作旋转，平移的运动，称之为刚体变换。刚体运动也可以理解为保持长度，角度，面积等不变的仿射变换。<br>
　　当我们描述一个机器人的位姿时，就是在描述一个刚体在三维空间中的运动。而且我们还要对这个估计出来的位姿进行进一步的优化。三维空间中，刚体的运动可以用两个概念来表示：旋转和平移。<br>
　　这里对向量进行一些补充：在描述旋转矩阵前，先明确向量这个概念。向量是空间中的一个具体实物且不和任何实数相关联。为了描述向量，应该先确定一个具体的坐标系，明确该坐标系的线性基。向量
　　向量坐标的具体取值，和向量本身和选取的坐标系是相关的。<br>
　　明确向量的坐标后，可以谈论向量间的运算，主要有两种运算：内积和外积(又叫叉积)。外积的计算结果仍然是一个向量，可以用来表示向量的旋转。

### 欧式变换
　　感觉重点来了：之前就有听到他们提到过关于坐标变换方面的问题，使用到的好像就是偶是变换～<br>
　　假设存在两个坐标系：一个是世界坐标系，定义为某个墙角和它的三条边，并且是一个惯性系；一个是机器人坐标系，是一个随机器人移动的坐标系，在我的这个应用中是机器人的视觉下的相机坐标系。假设机器人观察到了某个向量P，它在这两个坐标系中分别有一套坐标。因为向量是一个客观存在的实体，那么必然就存在一个关系能够将这两套坐标联系起来——这个关系就是欧式变换。<br>
　　因为机器人的运动是一个刚体运动，所以同一个向量在不同坐标系下的模长和方向都是不会发生变换的(在上面的刚性运动的定义中已经写到了)。这样的一个欧式变换就是由一个旋转和一个平移两部分组成的。看完了知乎上的一个讲解，简单来讲欧式变换的作用就是两个不同向量之间的转换的一个关系，在slam中，就是将机器人的视觉和真实的世界坐标系相结合起来。<br>
　　上面也写到了，一个欧式变换包含了旋转和平移两部分。在论文中看到了一个特殊的表达式SE(3)，在知乎上找到了相关的解释，SE(3)是一个特殊的群叫做特殊欧式群，从我粗糙的看完知乎上面的讲解来说，这个特殊欧式群实际上包含了两部分的内容，一个是用来描述旋转的旋转矩阵，另一个是描述平移的平移向量。假设原始向量为a，经过变换之后的向量a'=Ra+t，其中R表示的就是旋转矩阵，t表示的是平移向量。但是这样的问题是，式子不是线性的。所以引入了齐次坐标。在一个三维向量末尾加上一个1，得到一个四维向量，成为齐次坐标。——其实这些在看的论文里面也有讲到了。是非常重要的概念。![/downloads/转移矩阵.png](/downloads/转移矩阵.png)。<br>
　　类似旋转矩阵R，变换矩阵T可以组成一个集合，叫特殊欧式群。![/downloads/特殊欧式群.png](/downloads/特殊欧式群.png)

## 相机和图像
　　上面的内容是一些比较基础的机器人位姿的表示以及对它进行优化的工具，相当于是SLAM中运动方程的部分，接下来的内容是SLAM中的观测方程的内容。

### 多种坐标系

#### 相机坐标系
![/downloads/多种坐标系.png](/downloads/多种坐标系.png)
　　这一张图就包含了真实相机坐标系和物理成像平面还有像素平面。接下来需要做的内容就是讨论真实世界坐标系下物体的坐标在多种不同坐标系下是如何转换的。<br>
　　我们将相机坐标系定为O-x-y-z，O为相机的光心，z轴指向相机前方，x轴向右而y轴向下。真实世界中的一个点P，经过小孔O投影之后，落在物理成像平面O'-x'-y'(也称为像平面坐标系)上，称为像点P‘。<br>
　　假设P点在相机坐标系下的坐标为[X,Y,Z]T，P'的坐标为[X',Y',Z']T，焦距为f。根据相似三角形，我们可以推导出来的坐标间的关系为：Z/f=-X/X'=-Y/Y，负号表示的含义是成像是倒立的。整理之后可以得到：X'=fX/Z，Y'=fY/Z。到这里我们描述了点P和它成像之间的空间关系。在物理平面上定义一个像素坐标系O'-u-v。假设P’点在像素坐标上的坐标为[u,v]T。像素坐标系和物理成像O'-x'-y'之间相差缩放和平移。接下来推导物体的坐标从物理成像平面到像素坐标系之间的转换。![/downloads/空间坐标转换.png](/downloads/空间坐标转换.png){:height='80',weight='100'}
　　X',Y'前面的系数表示是坐标的缩放系数，Cx和Cy分别表示的是坐标点的平移系数，将X'=fX/Z,Y'=fY/Z分别带入到上式中，可以得到u=alpha*f*X/Z+Cx，v=beta*f*Y/Z+Cy。令alpha*f=fx,beta*f=fy，则u=fx*X/Z+Cx，v=fy*Y/Z+Cy。这个式子就得到了在相机坐标系下，一个空间点的三维坐标到其像素坐标的转换关系。<br>
　　和之前一样，利用齐次坐标，将上面的式子转换为矩阵形式：
![/downloads/相机内参矩阵.png](/downloads/相机内参矩阵.png){:height='80',width='100'}
　　直到这里还没有和最上面写到的位姿矩阵T结合起来，因为我们一直是处于相机坐标系下面。相机的位姿描述了相机在世界坐标系下的位置和姿态，也给出了世界坐标系到相机坐标系的变换关系。对于一组照片，如果取第一张照片对应的相机坐标系为世界坐标系，则对应的相机位姿为旋转矩阵为单位阵而平移向量为0。其他的照片对应的相机位姿为该世界坐标系下到该照片对应的相机坐标系的变换关系。因为相机在运动，所以点P的相机坐标应该是它的世界坐标，记作Pw，根据相机当前的位姿变换到相机坐标系下的结果。 <br>
　　加上位姿之后继续往下面进行推导：设Puv为在像素坐标平面上的坐标:![/downloads/像素坐标转换.png](/downloads/像素坐标转换.png){:height='80',width='100'}
　　在这个式子中R,t分别表示的是坐标系转换变换过程中的旋转和平移，T对应的是变换矩阵，都是表示相机的外参数，会随着相机的运动而发生改变，是SLAM过程中待估计的目标，表示着机器人的轨迹。上面的变换矩阵为世界坐标系到相机坐标系的变换，它对应的转置矩阵表示的就是从相机坐标系到世界坐标系下的转换。齐次坐标乘上一个非零常数之后得到的是同一个点，所以可以把上式的Z去掉，Puv=KTPw，式子中的K为相机的内参数矩阵，T是变换矩阵，Pw是对应的世界坐标系下的物体的坐标。因为经过TPw得到的是一个四维向量，而相机坐标系下到像素坐标下的转换是一个三维到二维的转换，所以我们需要对经过TPw处理之后的结果只取前三维，经相机的内参之后就得到了像素坐标。 