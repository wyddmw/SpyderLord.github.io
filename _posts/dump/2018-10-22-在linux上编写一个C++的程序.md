---
layout: post
category: dump
title: 在linux上使用Vim编写一个C/C++程序
description: g++命令以及cmake的指令
---

## 前期的准备工作
　　说起来前期的准备工作也不算繁琐，安装几个必要的软件就可以了：

```python
sudo apt-get install vim    #安装vim文本编辑工具
sudo apt-get install g++    #安装g++编译工具
```

## g++参数的问题
　　当我们安装好了g++编译器之后，我们就可以使用g++对写好的文件进行编译和运行，下面总结两个比较常用的g++命令的参数：
- -0: 制定目标名称，缺省的时候，g++编译出来的文件是a.out，在终端中是可以直接运行的。

```python
g++ -o main main.cpp
cd ../
./main      #在终端中便可以显示程序运行的结果。
```

- -c：生成一个对应的obj文件，对应的后缀是.o

```python
g++ -c main main.cpp
```

## cmake的安装

```python
sudo apt-get install cmake
```

　　首先是关于什么是cmake。看了一篇博客，cmake的功能大概就是告诉编译器如何去编译链接源代码。在windows平台下是通过project文件去管理这些，如果不适用cmake，就需要为windows和linux系统写对应的project文件和makefile文件(所以makefile文件对应的应该就是在linux上告诉编译器如何去编译链接源代码)。<br>
　　编写一个简单的cmake，使用cmake首先需要一个CmakeLists.txt文件，我们需要把配置文件写入该文件，然后通过cmake去处理这个文件。假设我们存在一个.cpp文件，这个时候我们就可以编写一个CmakeLists.txt文件。

```python
#cmake需要最小版本
cmake_minimum_required(VERSION 2.8)     #查了一下自己电脑上cmake的版本，cmake --version=3.4
#项目的名字
project(Hello)
#包含原程序，也就是把给定目录下的源程序复制给变量DIR_SRC
aux_source_directory(DIR_SRC ./)
#生成程序
add_executable(hello${DIR_SRC})     #但是在终端中运行的时候报错参数输入错误
#执行接下来的命令
mkdir build
cd build
cmake ..                            #命令的作用是根据CMakeLists.txt生成Makefile文件
make                                #命令用于执行Makefile文件，编译程序，生成可执行文件
```

```python
#参看通过Clion下生成的一个工程对应的CMakeLists.txt文件
cmake_minimum_required(VERSION 3.12)
project(untitled)                   #这个是整个工程project存放的目录名称
set(CMAKE_CXX_STANDARD 14)          #自己试了一下，如果没有这个配置项的话程序也是可以正常运行的。
set(SRC_LIST main.c)                #set命令是用来设置变量的。
add_executable(untitled main.cpp)   #告诉工程生成一个可执行的文件
```

　　那么关于使用cmake来运行程序和直接使用g++来运行程序之间的区别，感觉如果使用g++的话，直接使用编译器去运行程序，如果是使用make的话应该也是会存在一个调用编译器的过程的。

### 将一个工程拆分成三个文件
#### .h头文件
　　仍然是使用vim完成对头文件的编写，以一个简单的程序来说明：

```C
#ifndef _HELLO_H
#define _HELLO_H

void Hello(const char* name);

#endif
```

```C
#include <stdio.h>
#include "hello.h"
void Hello(const char* name)
{
    printf("Hello %s!/n",name);
}
```
1
```C
#include "hello.h"
int main()
{
    hello("Linux");
    return 0;
}
```

　　然后是CMakeLists文件的编写，虽然网上的博客中很多写的都很复杂，按照其中的一种测试的时候出错，报错的信息还没有搞清楚，有时间继续研究一下CMakeLists的编写，在CLion中新建了一个工程文件，包含多个头文件和源文件，看了一下生成的CMakeLists文件，很简单的两条命令就能够实现编译：

```python
cmake_minimun_required(VERSION 2.8)
project(Hello)
add_executable(main main.cpp hello.h hello.cpp hello.h)     #发现第一个参数的作用是命名在build文件夹下生成的可执行文件
```

　　之后的操作就是cmake和make，然后运行可执行文件即可。![](/downloads/cmake.png)
## 分割线2018-10-23
　　问了贾甄伟上面的那个问题，他告诉我，使用g++的方法和使用cmake的方法是两种不同层次的方法，如果我们有多个源文件的话，就不可能使用g++的方法去一一进行编译了。cmake是对多个源文件进行管理的工具，但是底层的工具链也是g++，如果只有一两个源文件的话，是可以通过g++直接来编译的。